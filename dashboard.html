<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Artist Dashboard ‚Äî Truly Yours DSP</title>

<style>
    body {
        background:#0d001a;
        color:white;
        font-family:Arial, sans-serif;
        margin:0;
        padding:0;
    }
    .navbar {
        background:rgba(255,255,255,0.05);
        padding:12px;
        display:flex;
        gap:20px;
        font-size:18px;
    }
    .navbar a { color:white; text-decoration:none; }
    .container { padding:30px; }
    li { margin-bottom:12px; }
    button {
        margin-top:6px;
        padding:6px 12px;
        cursor:pointer;
        border-radius:5px;
        border:none;
        background:#ff2ff5;
        color:black;
    }
</style>
</head>
<body>

<!-- ===== NAV ===== -->
<div class="navbar">
    <a href="index.html">HOME</a>
    <a href="upload.html">UPLOAD MORE</a>
    <a href="#" onclick="logout()">LOG OUT</a>
</div>

<div class="container">
    <h1>Welcome back, <span id="artistname"></span> üéß</h1>
    <p>Your wave is growing ‚Äî keep dropping heat.</p>

    <h2>Your Uploaded Songs üéµ</h2>
    <ul id="songList">Loading...</ul>
</div>


/* ==== LOAD SONGS ==== */
const songList = document.getElementById("songList");

async function loadSongs() {
  songList.innerHTML = "Loading‚Ä¶ üîÑ";

  const folder = ref(storage, "artists_audio/");
  const files = await listAll(folder);

  if (!files.items.length) {
    songList.innerHTML = "<li>No songs yet ‚Äî upload one üî•</li>";
    return;
  }

  songList.innerHTML = "";

  for (const fileRef of files.items) {
    const url = await getDownloadURL(fileRef);
    const fileName = fileRef.name.replace(/^\d+-/, "");

    const statRef = doc(db, "stats", fileRef.name);
    let stats = await getDoc(statRef);

    if (!stats.exists()) {
      await setDoc(statRef, { plays: 0, views: 0 });
      stats = await getDoc(statRef);
    }

    const { plays, views } = stats.data();

    const li = document.createElement("li");
    li.innerHTML = `
      üéµ <strong>${fileName}</strong><br>
      ‚ñ∂Ô∏è Plays: ${plays} &nbsp; üëÅ Views: ${views}<br>
      <button onclick="playSong('${fileRef.name}', '${url}')">PLAY</button>
    `;
    songList.appendChild(li);
  }
}


/* ==== PLAY / TRACK STATS ==== */
window.playSong = async (filename, url) => {
  const audio = new Audio(url);
  audio.play();

  const statRef = doc(db, "stats", filename);
  await updateDoc(statRef, {
    plays: increment(1),
    views: increment(1)
  });

  loadSongs();
};
</script>

</body>
</html>
