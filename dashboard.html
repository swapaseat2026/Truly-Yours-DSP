<!DOCTYPE html>
<html>
<head>
<title>Artist Dashboard ‚Äì Truly Yours DSP</title>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');

  :root {
    --neon-pink: #ff2bd1;
    --neon-purple: #7a00ff;
    --dark-bg: #050008;
    --light-text: #ffffff;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Inter', sans-serif;
    background: radial-gradient(circle at 20% 10%, #18001f, transparent 40%),
                radial-gradient(circle at 90% 20%, #000014, transparent 40%),
                var(--dark-bg);
    color: var(--light-text);
  }

  .navbar {
    width: 100%;
    padding: 18px 40px;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(6px);
    position: fixed;
    top: 0;
  }
  .navbar a {
    margin-right: 25px;
    color: var(--light-text);
    text-decoration: none;
  }

  .container {
    margin-top: 120px;
    width: 85%;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
  }

  h1 span {
    color: var(--neon-pink);
  }

  .section-box {
    background: rgba(255,255,255,0.05);
    padding: 25px;
    border-radius: 12px;
    margin-top: 25px;
    border: solid 1px rgba(255,255,255,0.08);
  }

  .upload-btn, .logout-btn {
    display: inline-block;
    background: linear-gradient(135deg, var(--neon-purple), var(--neon-pink));
    padding: 12px 25px;
    margin-top: 15px;
    border-radius: 8px;
    color: white;
    font-weight: 700;
    border: none;
    cursor: pointer;
    text-decoration: none;
  }
  .logout-btn {
    background: rgba(255,255,255,0.1);
  }
</style>
</head>

<body>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="firebase-init.js"></script>

<script>
firebase.auth().onAuthStateChanged(user => {
    if(user){
        document.getElementById("artistname").innerText = user.email.split("@")[0];
    } else {
        // location.href = "login.html"; // force login TURNED OFF
        console.log("No login detected ‚Äî dashboard open for testing üëç");
    }
});
</script>

<div class="navbar">
  <a href="index.html">HOME</a>
  <a href="upload.html">UPLOAD MORE</a>
  <a href="#" onclick="logout()">LOG OUT</a>
</div>

<div class="container">

  <!-- Welcome -->
  <h1>Welcome back, <span>Artist!</span>üåä</h1>
  <p>Your wave is growing ‚Äî keep dropping heat.</p>

  <!-- RECENT SONGS WITH STATS -->
<h2>Your Uploaded Songs üéß</h2>
<ul id="songList">Loading...</ul>

<!-- YouTube Links -->
<div class="section-box">
  <h2>Your YouTube Links</h2>
  <ul>
    <li><a href="https://youtube.com/" target="_blank" style="color:var(--neon-pink)">Example Link</a></li>
  </ul>
</div>

<!-- Logout -->
<a href="#" class="logout-btn" onclick="logout()">Log Out</a>

</div> <!-- container end -->
<!-- ==== DASHBOARD SCRIPT WITH STATS ==== -->
<script type="module">
  /* --- Firebase Imports --- */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
  import { getStorage, ref, listAll, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-storage.js";
  import { getFirestore, doc, setDoc, getDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

  /* --- Firebase Config --- */
  const firebaseConfig = {
    apiKey: "AIzaSyB9Wc9me_xmVEorMVSPMhTD9Lq7P6zjJA",
    authDomain: "truly-yours-dsp-2025.firebaseapp.com",
    projectId: "truly-yours-dsp-2025",
    storageBucket: "truly-yours-dsp-2025.appspot.com",
    messagingSenderId: "369021879682",
    appId: "1:369021879682:web:ded7b7e150ab8fbb3cbb9b"
  };

  /* --- Init Firebase --- */
  const app = initializeApp(firebaseConfig);
  const storage = getStorage(app);
  const db = getFirestore(app);

  const songList = document.getElementById("songList");
  const artistNameElement = document.getElementById("Artist");
  artistNameElement.innerText = "Your Name"; // placeholder

  /* ============================
     LOAD SONGS & SHOW STATS
     ============================ */
  async function loadSongs() {
    songList.innerHTML = "Loading songs... üîÑ";
    const folder = ref(storage, "artists_audio/");

    const files = await listAll(folder);
    songList.innerHTML = "";

    if (files.items.length === 0) {
      songList.innerHTML = "<li>No uploads yet ‚Äî drop one! üî•</li>";
      return;
    }

    for (const fileRef of files.items) {
      const url = await getDownloadURL(fileRef);
      const fileName = fileRef.name.replace(/^\d+-/, "");
      const statDoc = doc(db, "stats", fileRef.name);

      // Get or create stats
      let stats = await getDoc(statDoc);
      if (!stats.exists()) {
        await setDoc(statDoc, { plays: 0, views: 0 });
        stats = await getDoc(statDoc);
      }

      const { plays, views } = stats.data();

      // Create list item
      const li = document.createElement("li");
      li.innerHTML = `
        üéµ <strong>${fileName}</strong><br>
        ‚ñ∂Ô∏è Plays: ${plays} &nbsp;&nbsp; üëÅ Views: ${views}
        <br>
        <button style="margin-top:5px;" onclick="playSong('${fileRef.name}', '${url}')">
          PLAY
        </button>
      `;
      songList.appendChild(li);
    }
  }

  loadSongs();


  /* ============================
       PLAY SONG + TRACK STATS
     ============================ */
  window.playSong = async function(filename, url) {
    const audio = new Audio(url);
    audio.play();

    const statDoc = doc(db, "stats", filename);
    await updateDoc(statDoc, {
      plays: increment(1),
      views: increment(1)
    });

    loadSongs(); // refresh stats
  };

  /* ============================
        LOGOUT BUTTON
     ============================ */
  window.logout = function() {
    alert("Logout clicked ‚Äî login system coming üîê");
  };

</script>

<!-- üî• SCRIPT GOES **HERE** -->
<script>
  // loadSongs(), trackPlay(), logout(), etc
</script>

</body>
</html>

